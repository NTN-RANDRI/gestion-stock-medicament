<main class="px-4 md:px-6 py-6">
  <!-- En-tête -->
  <div class="mb-6">
    <a
      routerLink="/gestion-stock/demande"
      class="flex items-center gap-2 text-sm text-muted-foreground hover:text-primary transition-colors mb-4"
    >
      <i class="fas fa-arrow-left"></i>
      Retour aux commandes
    </a>

    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold text-foreground">Détails de la Commande</h1>
        <p class="text-muted-foreground">Référence: #CMD-{{demande?.id}}</p>
      </div>

      <div class="flex gap-3" *ngIf="demande?.statutDemande === 'EnAttente'">
        <button class="px-4 py-2 border border-border rounded-lg hover:bg-destructive/90 transition-colors bg-destructive text-destructive-foreground" (click)="showRefusModal = true">
          <i class="fas fa-times-circle mr-2"></i> Refuser
        </button>
        <button class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-opacity-90 transition-colors" (click)="showConfirmModal = true">
          <i class="fas fa-truck mr-2"></i> Livrer
        </button>
      </div>
    </div>
  </div>

  <!-- Section Client -->
  <div class="card p-6 mb-6">
    <div class="flex items-center gap-4 mb-4">
      <div class="bg-accent rounded-xl w-12 h-12 flex items-center justify-center">
        <i class="fas fa-user text-accent-foreground text-xl"></i>
      </div>
      <div>
        <h2 class="text-xl font-semibold">{{ demande?.nomClient }}</h2>
        <p class="text-muted-foreground text-sm">Client</p>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-border">
      <div>
        <p class="text-sm text-muted-foreground">Date</p>
        <p class="font-medium">{{ demande?.dateDemande| date:'dd/MM/yyyy' }}</p>
      </div>
      <div>
        <p class="text-sm text-muted-foreground">Statut</p>
        <span class="px-2 py-1 rounded-full text-xs" [ngClass]="couleurStatut(demande?.statutDemande || '')">
          {{ textStatut(demande?.statutDemande || '') }}
        </span>
      </div>
      <div>
        <p class="text-sm text-muted-foreground">Méthode de livraison</p>
        <p class="font-medium">À retirer en pharmacie</p>
      </div>
    </div>
  </div>

  <!-- Liste des médicaments -->
  <div class="card overflow-hidden mb-6">
    <div class="p-6 pb-3 border-b border-border">
      <h2 class="text-xl font-bold text-foreground flex items-center gap-2">
        <i class="fas fa-pills text-primary"></i>
        Médicaments commandés
      </h2>
    </div>

    <div class="overflow-auto custom-scrollbar max-h-[400px]">
      <table class="w-full">
        <thead class="bg-secondary sticky top-0">
          <tr class="text-left text-sm font-medium">
            <th class="p-4">Médicament</th>
            <th class="p-4">Quantité</th>
            <th class="p-4">Prix unitaire</th>
            <th class="p-4 text-right">Total</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-border">
          <tr *ngFor="let ligne of demande?.lignesDemande" class="hover:bg-secondary/50 transition-colors">
            <td class="p-4 font-medium">{{ ligne.nomMedicamnet }}</td>
            <td class="p-4">{{ ligne.quantite }}</td>
            <td class="p-4">{{ ligne.prixUnitaire }} ar</td>
            <td class="p-4 text-right font-medium">{{ ligne.prixTotal }} ar</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Total -->
  <div class="card p-6">
    <div class="flex justify-between items-center">
      <div>
        <p class="text-muted-foreground">Note</p>
        <p class="italic">Aucune note spécifiée</p>
      </div>
      <div class="text-right">
        <p class="text-lg text-muted-foreground">Total</p>
        <p class="text-2xl font-bold text-primary">{{ valeur | number }} ar</p>
      </div>
    </div>
  </div>
</main>

<div *ngIf="showConfirmModal">
  <app-confirm-modal
    title="Confirmation de livraison"
    question="Confirmez-vous la livraison de ce médicament ?"
    text=" Cette action enregistrera la livraison du médicament et mettra à jour le stock."
    (cancelEvent)="showConfirmModal = false"
    (confirmEvent)="confirmDemande()"
  />
</div>

<div *ngIf="showRefusModal">
  <app-refus-modal
    title="Confirmation de refus"
    question="Êtes-vous sûr de vouloir refuser cette commande ?"
    text="Cette action annulera la commande"
    (cancelEvent)="showRefusModal = false"
    (confirmEvent)="refuseDemande()"
  />
</div>
